<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>MONGLE_OS â€” 404</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root { --primary: #00ff41; --bg: #000; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: #000; color: var(--primary); font-family: 'Consolas', monospace; overflow: hidden; }
        #lockdown { position: fixed; inset: 0; background: #fff; color: #000; z-index: 1000; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        #app { display: none; height: 100vh; flex-direction: column; }
        .gate { border: 1px solid var(--primary); padding: 20px; text-align: center; background: #050505; }
        input { background: #000; border: 1px solid var(--primary); color: #fff; padding: 10px; margin: 10px 0; width: 80%; outline: none; }
        button { background: var(--primary); color: #000; border: none; padding: 10px 20px; cursor: pointer; font-weight: bold; }
        #status-msg { font-size: 10px; color: #555; margin-top: 10px; }
    </style>
</head>
<body>

    <div id="lockdown" onclick="this.style.display='none'; document.getElementById('login-box').style.display='flex';">
        <h1>404</h1><p>The requested URL was not found on this server.</p>
    </div>

    <div id="login-box" style="display:none; position:fixed; inset:0; align-items:center; justify-content:center; background:#000; z-index:2000;">
        <div class="gate">
            <h3>> IDENTITY_REQUIRED</h3>
            <input type="text" id="realName" placeholder="REAL NAME">
            <input type="text" id="username" placeholder="NICKNAME">
            <button onclick="initSession()">INITIALIZE</button>
            <div id="status-msg">WAITING FOR COMMAND...</div>
        </div>
    </div>

    <div id="app">
        <h2 style="padding: 20px; border-bottom: 1px solid #222;">> MONGLE_OS_v6.0_CONNECTED</h2>
        <div style="padding: 20px;">Welcome to the arcade. Your session is being monitored for stability.</div>
    </div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getDatabase, ref, set, onValue, onDisconnect, update } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

    const firebaseConfig = { 
        apiKey: "AIzaSyDgRvxKypPsOx379SNleE6Uij7mKkEJxGY", 
        databaseURL: "https://monglearcade-default-rtdb.firebaseio.com", 
        projectId: "monglearcade" 
    };
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    window.initSession = async () => {
        const rName = document.getElementById('realName').value;
        const uName = document.getElementById('username').value;
        if(!rName || !uName) return alert("All fields required.");

        // 1. GENERATE HARDWARE FINGERPRINT
        const FP = await import('https://openfpcdn.io/fingerprintjs/v3').then(m => m.load());
        const res = await FP.get();
        const hid = res.visitorId;

        // 2. CHECK IF BANNED
        onValue(ref(db, `blacklist/${hid}`), (snapshot) => {
            if (snapshot.exists()) {
                document.body.innerHTML = "<h1 style='color:red; text-align:center; margin-top:20%;'>SYSTEM TERMINATED: HARDWARE_BANNED</h1>";
                window.stop();
            }
        });

        // 3. LOG TO PRESENCE
        const userRef = ref(db, 'presence/' + hid);
        await set(userRef, {
            realName: rName,
            username: uName,
            hw_id: hid,
            joined: new Date().toLocaleTimeString(),
            status: "online"
        });

        onDisconnect(userRef).remove();

        // 4. LISTEN FOR ADMIN COMMANDS (Screen Cap, etc)
        onValue(userRef, (snap) => {
            const d = snap.val();
            if(!d) return;
            if(d.capReq) {
                html2canvas(document.body).then(canvas => {
                    update(userRef, { lastCap: canvas.toDataURL("image/webp", 0.3), capReq: false });
                });
            }
            if(d.reload) window.location.reload();
        });

        document.getElementById('login-box').style.display = 'none';
        document.getElementById('app').style.display = 'flex';
    };
</script>
</body>
</html>
